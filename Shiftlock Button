local ShiftLockScreenGui = Instance.new("ScreenGui")
local ShiftLockButton = Instance.new("ImageButton")
local ShiftlockCursor = Instance.new("ImageLabel")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ContextActionService = game:GetService("ContextActionService")
local Player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

local States = {
    Off = "rbxasset://textures/ui/mouseLock_off@2x.png",
    On = "rbxasset://textures/ui/mouseLock_on@2x.png",
    Lock = "rbxasset://textures/MouseLockedCursor.png",
    Lock2 = "rbxasset://SystemCursors/Cross"
}

local MaxLength = 900000
local EnabledOffset = CFrame.new(1.7, 0, 0)
local DisabledOffset = CFrame.new(-1.7, 0, 0)
local Active

ShiftLockScreenGui.Name = "Shiftlock"
ShiftLockScreenGui.Parent = CoreGui
ShiftLockScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ShiftLockScreenGui.ResetOnSpawn = false

ShiftLockButton.Parent = ShiftLockScreenGui
ShiftLockButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ShiftLockButton.BackgroundTransparency = 1
ShiftLockButton.Position = UDim2.new(0.7, 0, 0.75, 0)
ShiftLockButton.Size = UDim2.new(0.05, 0, 0.05, 0)
ShiftLockButton.SizeConstraint = Enum.SizeConstraint.RelativeXX
ShiftLockButton.Image = States.Off
ShiftLockButton.Draggable = true

ShiftlockCursor.Name = "Shiftlock Cursor"
ShiftlockCursor.Parent = ShiftLockScreenGui
ShiftlockCursor.Image = States.Lock
ShiftlockCursor.ImageTransparency = 0.5
ShiftlockCursor.Size = UDim2.new(0.03, 0, 0.03, 0)
ShiftlockCursor.Position = UDim2.new(0.5, 0, 0.5, 0)
ShiftlockCursor.AnchorPoint = Vector2.new(0.5, 0.5)
ShiftlockCursor.SizeConstraint = Enum.SizeConstraint.RelativeXX
ShiftlockCursor.BackgroundTransparency = 1
ShiftlockCursor.Visible = false

local function ToggleShiftLock()
    if not Active then
        Active = RunService.RenderStepped:Connect(function()
            local character = Player.Character
            if character and character:FindFirstChild("Humanoid") and character:FindFirstChild("HumanoidRootPart") then
                character.Humanoid.AutoRotate = false
                ShiftLockButton.Image = States.On
                ShiftlockCursor.Visible = true

                local lookVector = workspace.CurrentCamera.CFrame.LookVector
                local hrp = character.HumanoidRootPart
                hrp.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector * MaxLength)

                workspace.CurrentCamera.CFrame = workspace.CurrentCamera.CFrame * EnabledOffset
                workspace.CurrentCamera.Focus = CFrame.fromMatrix(
                    workspace.CurrentCamera.Focus.Position,
                    workspace.CurrentCamera.CFrame.RightVector,
                    workspace.CurrentCamera.CFrame.UpVector
                ) * EnabledOffset
            end
        end)
    else
        local character = Player.Character
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.AutoRotate = true
        end
        ShiftLockButton.Image = States.Off
        workspace.CurrentCamera.CFrame = workspace.CurrentCamera.CFrame * DisabledOffset
        ShiftlockCursor.Visible = false
        if Active then
            Active:Disconnect()
            Active = nil
        end
    end
end

ShiftLockButton.MouseButton1Click:Connect(ToggleShiftLock)

local function ShiftLockAction(name, state, input)
    if state == Enum.UserInputState.Begin then
        ToggleShiftLock()
    end
end

ContextActionService:BindAction("Shift Lock", ShiftLockAction, false, Enum.KeyCode.LeftShift)
ContextActionService:SetPosition("Shift Lock", UDim2.new(0.8, 0, 0.8, 0))
