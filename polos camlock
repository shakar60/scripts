-- Required Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

-- Notification Library
local NotificationLoad = loadstring(game:HttpGet('https://raw.githubusercontent.com/treeofplant/Notif/main/library.lua', true))()

-- Local Variables
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CamlockState = true
local Prediction = 0.1830871
local XPrediction = 0.176073
local YPrediction = 0.167092
local Smoothness = 0.095 -- Adjust for smoother or faster camera movement
local Locked = true
getgenv().Key = Enum.KeyCode.Q -- Use Enum.KeyCode for consistency

-- Function to Find Nearest Enemy
function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition = Vector2.new(
        game:GetService("GuiService"):GetScreenResolution().X / 2,
        game:GetService("GuiService"):GetScreenResolution().Y / 2
    )

    for _, Player in ipairs(game:GetService("Players"):GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            if Character and Character:FindFirstChild("HumanoidRootPart") and Character.Humanoid.Health > 0 then
                local Position, IsVisibleOnViewport = 
                    workspace.CurrentCamera:WorldToViewportPoint(Character.HumanoidRootPart.Position)

                if IsVisibleOnViewport then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = Character.HumanoidRootPart
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end

    return ClosestPlayer
end

local enemy = nil

-- Function to Smoothly Aim the Camera
RunService.Heartbeat:Connect(function()
    if CamlockState and enemy then
        local camera = workspace.CurrentCamera
        local targetPosition = enemy.Position + enemy.Velocity * Prediction
        targetPosition = Vector3.new(targetPosition.X + XPrediction, targetPosition.Y + YPrediction, targetPosition.Z)
        
        local currentPosition = camera.CFrame.Position
        local newPosition = currentPosition:Lerp(targetPosition, Smoothness)
        
        camera.CFrame = CFrame.new(newPosition, targetPosition)
    end
end)

-- Function to Handle Key Presses
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == getgenv().Key then
        Locked = not Locked
        if Locked then
            enemy = FindNearestEnemy()
            CamlockState = true
            -- Custom Notification
            NotificationLoad:NewNotification({
                ["Mode"] = "Custom",
                ["Title"] = "Polos Camlock",
                ["Description"] = "Locking On " .. (enemy.Parent and enemy.Parent.Name or "Unknown Player"),
                ["Notification_Image"] = "rbxassetid://18985517155",
                ["Notification_Sound"] = "",
                ["Timeout"] = 2,
                ["Audio"] = false
            })
        else
            if enemy then
                enemy = nil
                CamlockState = false
                -- Custom Notification
                NotificationLoad:NewNotification({
                    ["Mode"] = "Custom",
                    ["Title"] = "Polos Camlock",
                    ["Description"] = "Unlocked",
                    ["Notification_Image"] = "rbxassetid://18985517155",
                    ["Notification_Sound"] = "",
                    ["Timeout"] = 2,
                    ["Audio"] = false
                })
            end
        end
    end
end)

-- UI Setup
local BladLock = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TextButton = Instance.new("TextButton")
local UICorner_2 = Instance.new("UICorner")

-- Properties
BladLock.Name = "BlackGuy"
BladLock.Parent = game.CoreGui
BladLock.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = BladLock
Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- Set background to black
Frame.BorderColor3 = Color3.fromRGB(0, 0, 0)
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.133798108, 0, 0.20107238, 0)
Frame.Size = UDim2.new(0, 80, 0, 70)
Frame.Active = true
Frame.Draggable = true

local function TopContainer()
    Frame.Position = UDim2.new(0.5, -Frame.AbsoluteSize.X / 2, 0, -Frame.AbsoluteSize.Y / 2)
end

TopContainer()
Frame:GetPropertyChangedSignal("AbsoluteSize"):Connect(TopContainer)

UICorner.Parent = Frame

TextButton.Parent = Frame
TextButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- Set background to black
TextButton.BackgroundTransparency = 1
TextButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
TextButton.BorderSizePixel = 0
TextButton.Position = UDim2.new(0.0792079195, 0, 0.18571429, 0)
TextButton.Size = UDim2.new(0, 70, 0, 50)
TextButton.Font = Enum.Font.SourceSansSemibold
TextButton.Text = "Polos Camlock"  -- Removed comma
TextButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- Set text color to white
TextButton.TextScaled = true
TextButton.TextSize = 24
TextButton.TextWrapped = true

local state = true
TextButton.MouseButton1Click:Connect(function()
    state = not state
    if not state then
        TextButton.Text = "Polos Camlock On"
        CamlockState = true
        enemy = FindNearestEnemy()
        -- Custom Notification
        NotificationLoad:NewNotification({
            ["Mode"] = "Custom",
            ["Title"] = "Polos Camlock",
            ["Description"] = "Locking On " .. (enemy.Parent and enemy.Parent.Name or "Unknown Player"),
            ["Notification_Image"] = "rbxassetid://18985517155",
            ["Notification_Sound"] = "",
            ["Timeout"] = 2,
            ["Audio"] = false
        })
    else
        TextButton.Text = "Polos Camlock Off"
        CamlockState = false
        enemy = nil
        -- Custom Notification
        NotificationLoad:NewNotification({
            ["Mode"] = "Custom",
            ["Title"] = "Polos Camlock",
            ["Description"] = "Unlocked",
            ["Notification_Image"] = "rbxassetid://18985517155",
            ["Notification_Sound"] = "",
            ["Timeout"] = 2,
            ["Audio"] = false
        })
    end
end)

UICorner_2.Parent = TextButton
Frame.Active = true
Frame.Draggable = true

local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

RunService.Heartbeat:Connect(function()
    if dragging and dragInput then
        update(dragInput)
    end
end)

NotificationLoad:NewNotification({
    ["Mode"] = "Custom",
    ["Title"] = "Polos Camlock Loaded",
    ["Description"] = "Welcome User, If you are on PC or with a keyboard, press Q to turn the Camlock On And Off.",
    ["Notification_Image"] = "rbxassetid://18985517155",
    ["Notification_Sound"] = "rbxassetid://5153734608",
    ["Timeout"] = 10,
    ["Audio"] = true
})

-- Function to show the custom notification
local function showNotification(title, description)
    NotificationLoad:NewNotification({
        ["Mode"] = "Custom", 
        ["Title"] = title, 
        ["Description"] = description, 
        ["Notification_Image"] = "rbxassetid://18985517155", 
        ["Notification_Sound"] = "rbxassetid://5153734608", 
        ["Timeout"] = 10, 
        ["Audio"] = true 
    })
end

-- Initialize the Polo GUI
local PoloGui = createToggleGui()

-- Show initial notification when the script starts
showNotification("Info", "Type /e killpolo To Kill The Polo, Type /e polo To Bring The Polo Back")

-- Function to handle the chat commands
local function onChatMessage(message)
    if message == "/e killpolo" then
        -- Kill the Polo GUI and show notification
        if PoloGui then
            PoloGui:Destroy()
            PoloGui = nil
            showNotification("Info", "Polo GUI Killed")
        end
    elseif message == "/e polo" then
        -- Recreate the Polo GUI if it's not already active
        if not PoloGui then
            PoloGui = createToggleGui()
            showNotification("Info", "Polo GUI Restored")
        end
    end
end

-- Connect the chat listener
game.Players.LocalPlayer.Chatted:Connect(onChatMessage)
